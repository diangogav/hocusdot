#!/usr/bin/env bash

# Check dependencies
for cmd in fzf bat lsd; do
  if ! command -v $cmd &> /dev/null; then
    echo "âŒ Error: $cmd is required but not installed."
    exit 1
  fi
done

# Function to browse directories
browse() {
  local dir="$1"
  find "$dir" -mindepth 1 -maxdepth 1 | fzf \
    --prompt="ðŸ“‚ Select script > " \
    --preview='if [ -d {} ]; then lsd --tree --classify {}; else bat --color=always --style=numbers {}; fi' \
    --preview-window=right:60% \
    --height=80% \
    --layout=reverse
}

# Main loop
current_path="${DOTFILES_PATH:-$HOME/.dotfiles}/scripts"
selected=$(browse "$current_path")

while [[ -d "$selected" ]]; do
  current_path="$selected"
  selected=$(browse "$current_path")
done

if [[ -n "$selected" && -f "$selected" ]]; then
  echo "ðŸš€ Running: $(basename "$selected")"
  "$selected" "$@"
fi